{#
  移植自 http://moxfive.xyz/2016/06/14/duoshuo-disqus-comment-count/#footer
  基于 https://github.com/theme-next/hexo-theme-next
#}

{% set ccLicense = "署名-非商用-相同方式共享 4.0" %}
{% set ccLicenseTitle = "CC BY-NC-SA 4.0 International"%}
{% set ccText = ccLicense | upper %}
{% set ccURL = 'http://creativecommons.org/licenses/by-nc-sa/4.0/' %}

{% set postURL = page.url or page.permalink %}

{# 
  设置你自己的源文件仓库信息 
#}
{% set username = "lengthmin" %}
{% set repository = "lengthmin.me" %}
{% set branch = "hexo" %}

{# 
  设置 copyright 的文字提示 
  __("post.xxxx") 获取 language 文件中的字段  
#}
{% set authorText = "文章作者" %}
{% set titleText = "文章标题" %}
{% set linkText = "文章链接" %}
{% set updatedText = "更新时间" %}
{% set historyText = "更新历史" %}
{% set rawText = "源文件" %}
{% set licenseTitle = "版权声明" %}
{% set licenseContent = "%s  转载请保留原文链接及作者。" %}

<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>{{ authorText  }}：
    </strong>
    {{ page.author or author }}

  </li>
  <li class="post-copyright-title">
    <strong>{{ titleText  }}：
    </strong>
    <a href="{{ url_for(page.path) }}">
      {{ page.title }}
    </a>
  </li>
  <li class="post-copyright-link">
    <strong>{{ linkText  }}：</strong>

    {{ next_url(postURL, postURL, {title: page.title}) }}
    <span class="copy-path" title="点击复制文章链接">
      <i class="fa fa-clipboard"></i>
    </span>
    <span class="copytooltip"></span>
    <script>
      var x = 10;
      var y = 20;
      var copyButton = document.querySelector('.copy-path');
      var copyTooltip = document.querySelector('.copytooltip');
      let timeout;
      copyButton.addEventListener('click', function (e) {
        var ta = document.createElement('input');
        ta.value = "原文作者：{{ page.author or author }}\n原文标题：{{ page.title }}\n原文链接：{{ postURL }}";
        ta.setAttribute('readonly', 'readonly');
        document
          .body
          .appendChild(ta);
        ta.setSelectionRange(0, ta.value.length);
        document
          .body
          .removeChild(ta);
        var result = document.execCommand('copy');
        if (copyTooltip.hasChildNodes()) {
          copyTooltip.removeChild(copyTooltip.firstChild);
        }
        if (timeout) {
          clearTimeout(timeout);
        }
        if (result) {
          copyTooltip.append('复制成功');
        } else {
          copyTooltip.append('复制失败');
        }
        timeout = setTimeout(() => {
          while (copyTooltip.hasChildNodes()) {
            copyTooltip.removeChild(copyTooltip.firstChild);
          }
        }, 2000);
      });
    </script>
  </li>
  <li class="post-copyright-updated">
    <strong>{{ updatedText  }}：
    </strong>
    {{ page.updated.format("YYYY-MM-DD, HH:mm:ss") }}
  </li>
  <li class="post-copyright-history">
    <strong>{{ historyText  }}：</strong>
    <i class="fab fa-github"></i>
    <a href="https://github.com/{{ username }}/{{ repository }}/blame/{{ branch }}/source/{{ page.source }}" title="顺序查看文章各部分修改记录" target="_blank">Blame</a>,
    <a href="https://github.com/{{ username }}/{{ repository }}/commits/{{ branch }}/source/{{ page.source }}" title="查看文章有关更新记录" target="_blank">History</a>
    <strong style="margin-left: 1em">{{ rawText  }}：</strong>
    <i class="fas fa-file-alt"></i>
    <a href="https://raw.githubusercontent.com/{{ username }}/{{ repository }}/{{ branch }}/source/{{ page.source }}" title="查看 & 下载文章 Markdown 原始文件" target="_blank">.md Raw</a>
  </li>
  <li class="post-copyright-license">
    <strong>{{ licenseTitle  }}：
    </strong>
    <i class="fab fa-creative-commons"></i>
    {{ __(licenseContent, next_url(ccURL, ccText, {title: ccLicenseTitle }))  }}
  </li>
</ul>
